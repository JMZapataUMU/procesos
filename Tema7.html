<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>8&nbsp; Tema 7. Modelos de series temporales con variables exógenas – Procesos estocásticos y series temporales</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Tema6.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-364982630eef5352dd1537128a8ed5cb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Tema7.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Tema 7. Modelos de series temporales con variables exógenas</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Buscar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Procesos estocásticos y series temporales</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Presentación</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Tema1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Tema 1. Introducción a los procesos estocásticos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Tema2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tema 2. Cadenas de Markov</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Tema3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Tema 3. Procesos de Poisson</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Tema4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Tema 4. Conceptos básicos en series temporales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Tema5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Tema 5. Métodos de Alisado Exponencial</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Tema6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Tema 6. Modelos ARIMA</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Tema7.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Tema 7. Modelos de series temporales con variables exógenas</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><span class="header-section-number">8.1</span> Introducción</a></li>
  <li><a href="#el-modelo-de-regresión-múltiple-para-series-temporales" id="toc-el-modelo-de-regresión-múltiple-para-series-temporales" class="nav-link" data-scroll-target="#el-modelo-de-regresión-múltiple-para-series-temporales"><span class="header-section-number">8.2</span> El modelo de Regresión Múltiple para series temporales</a></li>
  <li><a href="#algunos-predictores-útiles" id="toc-algunos-predictores-útiles" class="nav-link" data-scroll-target="#algunos-predictores-útiles"><span class="header-section-number">8.3</span> Algunos predictores útiles</a></li>
  <li><a href="#consideraciones-sobre-el-modelo-y-sobre-las-predicciones" id="toc-consideraciones-sobre-el-modelo-y-sobre-las-predicciones" class="nav-link" data-scroll-target="#consideraciones-sobre-el-modelo-y-sobre-las-predicciones"><span class="header-section-number">8.4</span> Consideraciones sobre el modelo y sobre las predicciones</a>
  <ul class="collapse">
  <li><a href="#regresión-espuria" id="toc-regresión-espuria" class="nav-link" data-scroll-target="#regresión-espuria"><span class="header-section-number">8.4.1</span> Regresión espuria</a></li>
  <li><a href="#predicciones-ex-ante-y-ex-post.-intervalos-de-predicción" id="toc-predicciones-ex-ante-y-ex-post.-intervalos-de-predicción" class="nav-link" data-scroll-target="#predicciones-ex-ante-y-ex-post.-intervalos-de-predicción"><span class="header-section-number">8.4.2</span> Predicciones ex-ante y ex-post. Intervalos de predicción</a></li>
  </ul></li>
  <li><a href="#ejemplo" id="toc-ejemplo" class="nav-link" data-scroll-target="#ejemplo"><span class="header-section-number">8.5</span> Ejemplo</a></li>
  <li><a href="#modelos-de-regresión-dinámica" id="toc-modelos-de-regresión-dinámica" class="nav-link" data-scroll-target="#modelos-de-regresión-dinámica"><span class="header-section-number">8.6</span> Modelos de regresión dinámica</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Tema 7. Modelos de series temporales con variables exógenas</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introducción" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="introducción"><span class="header-section-number">8.1</span> Introducción</h2>
<p>En los temas anteriores, hemos visto técnicas para analizar series temporales donde se extrae información exclusivamente de la propia serie en estudio, ya sea descomponiendo la serie en varias componentes, o bien identificando el modelo generador a partir de las autocorrelaciones de los datos.</p>
<p>En este tema consideraremos el uso de otras variables diferentes a la variable de interés para explicar y predecir la serie en estudio. Por ejemplo, consideremos el consumo eléctrico horario de un hogar. Por una parte, presenta varias estacionalidades: periodo 24 horas (estacionalidad diaria) y periodo 168 horas (estacionalidad semanal). Además, presenta correlación significativa para el retardo de 1 hora. Por tanto, podríamos plantear un modelo SARIMA para este tipo de series. Sin embargo, también parece claro que existen otros factores externos que influyen en el consumo electrico horario de un hogar, como son la temperatura (debido al uso de climatización eléctrica), el tipo de día (diferenciando entre laborables y festivos) o el precio de la energía (si el usuario tiene contrato indexado al precio de mercado). A estas otras variables, distintas a la variable objeto de estudio y con influencia sobre ésta, se les denominan <strong>variables exógenas</strong>, que actuarán como predictores.</p>
<p><strong>Notación:</strong> En adelante, usaremos la notación <span class="math inline">\(y_t\)</span> para referirnos al valor de la serie en estudio en el instante <span class="math inline">\(t\)</span>, y usaremos <span class="math inline">\(x_{i,t}\)</span> con <span class="math inline">\(i=1,2,...,k\)</span> para referirnos a la variable exógena predictora <span class="math inline">\(x_i\)</span> en el instante <span class="math inline">\(t\)</span>. Esto supone un cambio respecto a la notación usada en los temas anteriores (donde la serie en estudio se denotaba por <span class="math inline">\(x_t\)</span>), siendo ahora necesario distinguir entre variable de interés a predecir y variables predictoras.</p>
</section>
<section id="el-modelo-de-regresión-múltiple-para-series-temporales" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="el-modelo-de-regresión-múltiple-para-series-temporales"><span class="header-section-number">8.2</span> El modelo de Regresión Múltiple para series temporales</h2>
<p>Por analogía al modelo de Regresión Lineal Múltiple (RLM) visto en asignaturas anteriores, en el contexto de series temporales el modelo RLM se suele expresar de la siguiente forma:</p>
<p><span class="math display">\[
Y_t = \beta_0 + \beta_1 x_{1,t} + \beta_2 x_{2,t} + ...+ \beta_k x_{k,t}  + \epsilon_t  \quad \text{con} \quad \varepsilon_t \sim N(0,\sigma^2) \   \text{independientes}, t \in \mathbb{T}.
\]</span></p>
<p>En este caso, <span class="math inline">\({Y_t}\)</span> representa el proceso estocástico generador de la serie en estudio <span class="math inline">\({y_t}\)</span>, y asumimos que los predictores <span class="math inline">\(x_i\)</span> no son variables aleatorias sino que son controlables, o al menos serán variables observables.</p>
<p>Recordemos que los errores deben tener media nula para no proporcionar predicciones sesgadas. Además deben estar incorrelados entre sí y con los predictores, para garantizar que se ha extraído toda la información posible de los datos (parte determinista). La hipótesis de Normalidad y varianza constante (Homocedasticidad) se utiliza para la obtención de intervalos de predicción.</p>
<p>A continuación comentamos algunas etapas habituales en los análisis RLM (visto en asignaturas anteriores) que son de aplicación a los modelos de regresión de series temporales.</p>
<ul>
<li><p>La estimación de los coeficientes <span class="math inline">\(\beta_j\)</span>, que denotaremos por <span class="math inline">\(\hat{\beta}_j\)</span>, se puede realizar mediante el criterio de mínimos cuadrados o mediante estimación máximo verosímil. Recordemos que la función <span class="math inline">\(lm()\)</span> de R permite la estimación de los coeficientes en un modelo RLM, pero también se pueden usar otras funciones más específicas para series temporales como <span class="math inline">\(tslm()\)</span> del paquete <em>forecast</em> o la función <em>TSLM()</em> del paquete <em>fable</em>.</p></li>
<li><p>La selección del modelo se puede realizar usando los métodos iterativos backward, forward y stepwise. Otra opción es buscar el mejor conjunto de regresores (predictores) atendiendo al cálculo de medidas de bondad del ajuste que permitan la comparativa entre modelos con distinto número de parámetros: R cuadrado ajustado (<span class="math inline">\(R_{adjusted} ^2\)</span>), validación cruzada (<span class="math inline">\(CV\)</span>), criterios <span class="math inline">\(AIC\)</span>, <span class="math inline">\(AIC_{corrected}\)</span> y <span class="math inline">\(BIC\)</span>.</p></li>
<li><p>La validación del modelo se realiza a través del análisis de los residuos (hipótesis de Normalidad, Homocedasticidad e Independencia), así como estudiando la multicolinealidad y la existencia de valores influyentes.</p></li>
<li><p>Una vez seleccionado y validado el modelo, se pueden calcular tanto predicciones puntuales como intervalos de predicción para instantes futuros.</p></li>
</ul>
<p>Indicar que también se pueden proponer modelos de regresión múltiple no lineales, por ejemplo considerando potencias de las variables exógenas o interacciones entre ellas.</p>
</section>
<section id="algunos-predictores-útiles" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="algunos-predictores-útiles"><span class="header-section-number">8.3</span> Algunos predictores útiles</h2>
<p>Existen predictores de especial utilidad en el contexto de modelos de regresión para series temporales, muchos de ellos debidos al “efecto calendario” sobre la serie en estudio. A continuación describimos con detalle algunos de ellos.</p>
<p><strong>El tiempo como predictor de las Tendencias</strong></p>
<p>Es común que los datos de la serie temporal muestren una tendencia. Por ejemplo, una tendencia lineal se puede modelar utilizando como predictor el tiempo <span class="math inline">\(t\)</span>:</p>
<p><span class="math display">\[
Y_t = \beta_0 + \beta_1 t + \varepsilon_t  \quad \text{con} \quad \varepsilon_t \sim N(0,\sigma^2) \  \text{independientes}, t \in \mathbb{T}.
\]</span></p>
<p>Y una tendencia cuadrática se puede modelar utilizando como predictores el tiempo <span class="math inline">\(t\)</span> y su cuadrado <span class="math inline">\(t^2\)</span>:</p>
<p><span class="math display">\[
Y_t = \beta_0 + \beta_1 t + \beta_2 t^2 + \varepsilon_t  \quad \text{con} \quad \varepsilon_t \sim N(0,\sigma^2) \  \text{independientes}, t \in \mathbb{T}.
\]</span></p>
<p>Sin embargo, en general no se recomienda la modelización de la tendencia con potencias de <span class="math inline">\(t^2\)</span> o superiores, pues no suele reflejar de forma realista la evolución futura de la serie. En su lugar, es preferible el uso de tendencias lineales a trozos.</p>
<p>La creación del predictor tiempo puede realizarse manualmente o bien usando funciones especiales, como es el caso de <em>trend</em> dentro de la función <em>tslm()</em> o el caso de <em>trend()</em> dentro de la función <em>TSLM()</em>.</p>
<p><strong>Variables dummy</strong></p>
<p>En general, los predictores toman valores numéricos. Sin embargo, podemos disponer de predictores categóricos que tengan una influencia significativa en la serie analizada. Por ejemplo, en una serie de consumo eléctrico horario, el tipo de día (laborable o festivo) tiene influencia relevante. Esta situación se puede tratar dentro del marco de los modelos de regresión múltiple creando una “variable dummy” que toma el valor 1 para la categoría “día festivo” y el valor 0 para “día laborable”.</p>
<div id="def-varDummy" class="theorem definition">
<p><span class="theorem-title"><strong>Definición 8.1</strong></span> Una <strong>variable dummy</strong>, también conocida como “variable indicadora”, es una variable binaria que sólo toma los valores 0 y 1.</p>
</div>
<p>Las variables dummy también se utilizan como predictor para distinguir periodos vacacionales especiales como la Semana Santa, que no tienen un calendario fijo: para los instantes correspondientes a Semana Santa, la variable dummy toma el valor 1, y para el resto de intantes toma el valor 0.</p>
<p>Si hay más de dos categorías, entonces la variable puede codificarse usando varias variables dummy. Concretamente, se necesitan tantas variables dummy como el número total de categorías menos uno. Algunas funciones de R (como por ejemplo <em>TSLM()</em>) tratan automáticamente esta situación si se especifica que la variable categórica es de tipo factor, de manera que no es necesario crear manualmente las variables dummy correspondientes.</p>
<p>Por ejemplo, si consideramos el predictor “día de la semana”, entonces se crearán 6 variables dummy para identificar si se trata de un lunes, martes, …, o domingo. En el modelo de regresión, la interpretación de cada uno de los coeficientes asociados a las variables dummy es una medida del efecto de esa categoría en relación con la categoría omitida. Para el predictor categórico “día de la semana” del ejemplo, si consideramos el “domingo” como categoría omitida, tendremos 6 variables dummy (la primera para indicar los lunes, la segunda para los martes, …, la sexta para los sábados); el coeficiente de regresión de la variable dummy de los lunes se interpreta como el efecto de los lunes en relación a los domingos, efecto que se refleja en un aumento o disminución de la constante del modelo (intercept).</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Observación
</div>
</div>
<div class="callout-body-container callout-body">
<p>En particular, las variables dummy se pueden usar como predictores de la Estacionalidad de una serie (variables dummy estacionales). Si la serie presenta Estacionalidad de periodo <span class="math inline">\(L\)</span>, consideraremos <span class="math inline">\(L-1\)</span> variables dummy como indicadoras de cada estación.</p>
</div>
</div>
<p>Una variable dummy también se puede usar para tener en cuenta un valor atípico en los datos. En lugar de omitir el valor atípico, la variable dummy elimina su efecto. En este caso, la variable dummy toma el valor 1 para la observación atípica y 0 en todos los demás casos.</p>
<p><strong>Variables de Intervención como variables dummy</strong></p>
<p>A menudo es necesario modelar “intervenciones” que pueden afectar a la serie temporal en estudio, entiendiendo como tal la ocurrencia de eventos especiales que no vienen recogidos en otras variables exógenas. Por ejemplo, la serie temporal del consumo eléctrico horario de un hogar, vendrá influenciada por eventos del tipo: (1) reemplazamiento de la iluminaria y electrodomésticos del hogar por dispositivos de muy bajo consumo; (2) corte puntual de una hora del suministro eléctrico.</p>
<p>En el caso (1), introduciremos una variable dummy que tome el valor 0 antes del evento y el valor 1 desde el instante del evento en adelante. Se trata de una variable que produce un escalón en el nivel de la serie (step variable), pues el evento produce un efecto permanente en la serie en estudio. Este tipo de variables también pueden reflejar el efecto de un evento en un perido temporal concreto, por ejemplo, una subida considerable del precio de la electricidad durante varias horas podría cambiar temporalmente el comportamiento del consumidor por temas económicos.</p>
<p>En el caso (2), introduciremos una variable dummy que tome el valor 1 en el instante sin suministro eléctrico y que tome el valor 0 en el resto de instantes. Se trata de variable pico (spike variable), pues el evento produce un efecto sólo en un instante. Este escenario es equivalente a la gestión de atípicos (outliers) usando variables dummy.</p>
<p><strong>Número de días laborables</strong></p>
<p>En el caso de analizar series de datos mensuales, otro predictor que suele ser útil es el número de días laborables del mes, ya que puede variar sustancialmente de un mes a otro con efecto sobre la serie en estudio.</p>
<p>Por ejemplo, si consideramos la serie de consumo eléctrico mensual de una industria, puede haber meses con menos días laborables que otros afectando al consumo eléctrico de dicha industria. Una opción sería considerar un predictor que represente el número de días laborables de cada mes. Otra opción sería definir 7 predictores de la siguiente forma:</p>
<p><span class="math display">\[
\begin{aligned}
x_1 &amp;= \text{número de lunes laborables del mes} \\
x_2 &amp;= \text{número de martes laborables del mes} \\
...\\
x_7 &amp;= \text{número de domingos laborables del mes}
\end{aligned}
\]</span></p>
<p><strong>Variables retardadas en el tiempo</strong></p>
<p>En algunas series temporales resulta útil considerar como predictores variables retardadas en el tiempo, pudiendo tratarse de variables exógenas o bien de la propia variable de interés.</p>
<p>Por ejemplo, en una serie de consumo eléctrico horario, suelen introducirse como predictores los propios consumos con retardos de 1h, 2h, …, 24h. También podríamos considerar como predictor la variable exógena de Temperatura con retardo de 1 hora.</p>
<p><strong>Series de Fourier como predictores de la Estacionalidad</strong></p>
<p>Una alternativa al uso de variables dummy estacionales consiste en emplear las series de Fourier, especialmente en el caso de series con periodos estacionales largos. Tiene como base que cualquier función periódica puede aproximarse por una combinación de términos de senos y cosenos.</p>
<p>Si <span class="math inline">\(L\)</span> es el periodo estacional, entonces los primeros términos de Fourier vienen dados por:</p>
<p><span class="math display">\[
x_{1,t}=sin(\frac {2 \pi t} {L}); \quad x_{2,t}=cos(\frac {2 \pi t} {L});
x_{3,t}=sin(\frac {4 \pi t} {L}); \quad x_{4,t}=cos(\frac {4 \pi t} {L});
\]</span></p>
<p>y en general, para frecuencia <span class="math inline">\(k=1,2,3,...\)</span>:</p>
<p><span class="math display">\[
x_{2k-1,t}=sin(\frac {2k \pi t} {L}); \quad x_{2k,t}=cos(\frac {2k \pi t} {L})
\]</span></p>
<p>El número máximo de pares de términos de Fourier (“seno” y “coseno”) que deben considerarse es <span class="math inline">\(K=[\frac L 2]\)</span>, donde [.] denota la parte entera. Si <span class="math inline">\(L\)</span> es par, se puede comprobar que no se requieren más términos porque al aumentar <span class="math inline">\(k\)</span> se obtienen series redundantes, bien idénticas o cambiadas de signo. Si <span class="math inline">\(L\)</span> es impar, las frecuencias <span class="math inline">\(k&gt;\frac L 2\)</span> no dan lugar a términos redundantes, pero su contribución para describir la estacionalidad suele ser marginal.</p>
<p>Por ejemplo, para datos mensuales donde <span class="math inline">\(L=12\)</span>, tendremos que <span class="math inline">\(K=6\)</span> y por tanto hay un total de 12 variables predictoras (6 senos y 6 cosenos). En realidad, se puede ver que el predictor número 11 se anula para todo <span class="math inline">\(t=1,2,3,...\)</span>:</p>
<p><span class="math display">\[
x_{11,t}=sin(\frac {12 \pi t} {12}) = 0
\]</span></p>
<p>En resumen, los 11 predictores (5 senos y 6 cosenos) dados por los términos de Fourier equivalen a usar las 11 variables dummy estacionales.</p>
<p>En general, al usar términos de Fourier se necesitan menos predictores que con variables dummy, especialmente cuando el perido <span class="math inline">\(L\)</span> es grande. Por ejemplo, para datos semanales donde <span class="math inline">\(L=52\)</span>. Cuando el periodo es pequeño, por ejemplo para datos cuatrimestrales, no hay ventaja en usar términos de Fourier frente a dummies.</p>
</section>
<section id="consideraciones-sobre-el-modelo-y-sobre-las-predicciones" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="consideraciones-sobre-el-modelo-y-sobre-las-predicciones"><span class="header-section-number">8.4</span> Consideraciones sobre el modelo y sobre las predicciones</h2>
<p>En esta sección vamos a comentar algunos aspectos a tener en cuenta cuando se propone un modelo de Regresión Múltiple para una serie temporal, así como a la hora de realizar predicciones.</p>
<section id="regresión-espuria" class="level3" data-number="8.4.1">
<h3 data-number="8.4.1" class="anchored" data-anchor-id="regresión-espuria"><span class="header-section-number">8.4.1</span> Regresión espuria</h3>
<p>La regresión espuria en series temporales ocurre cuando se observa una relación significativa entre dos series temporales no estacionarias, pero esta relación es en realidad falsa o engañosa. Esto se debe a que ambas series temporales pueden estar influenciadas por tendencias o patrones a largo plazo similares, lo que da la apariencia de una relación significativa cuando, en realidad, no hay una relación causal directa entre las variables.</p>
<p>Las series temporales no estacionarias a menudo presentan una alta correlación simplemente debido a sus tendencias comunes a largo plazo, no porque estén relacionadas causalmente. Por ejemplo, consideremos las series de la siguiente figura, una representando los pasajeros en Australia y la otra la producción de arroz en Guinea.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="spurious_1.jpg" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption>Regresión espuria. Fuente: Hyndman and Athanasopoulos (2021)</figcaption>
</figure>
</div>
</div>
</div>
<p>Ambas parecen estar relacionadas simplemente porque tienen tendencias similares. Si realizamos una regresión lineal entre ambas, podríamos obtener un valor alto de <span class="math inline">\(R^2\)</span> y coeficientes significativos, sugiriendo una relación entre las dos series. Sin embargo, nada tienen que ver.</p>
<p>Indicar que en ocasiones, la regresión espuria puede proporcionar predicciones aceptables a muy corto plazo, pero en general no serán adecuadas cuando se avance en el tiempo.</p>
<p>Algunos signos de la regresión espuria son un <span class="math inline">\(R^2\)</span> elevado y alta autocorrelación de los residuos. Si las series no son estacionarias, una solución común es tomar diferencias para transformar las series en estacionarias.</p>
</section>
<section id="predicciones-ex-ante-y-ex-post.-intervalos-de-predicción" class="level3" data-number="8.4.2">
<h3 data-number="8.4.2" class="anchored" data-anchor-id="predicciones-ex-ante-y-ex-post.-intervalos-de-predicción"><span class="header-section-number">8.4.2</span> Predicciones ex-ante y ex-post. Intervalos de predicción</h3>
<p>Las predicciones ex-ante y ex-post son dos enfoques utilizados en la evaluación y comparación de modelos de pronóstico en el análisis de series temporales. A continuación se describe la diferencia entre ambos tipos de predicciones.</p>
<p><strong>Predicciones ex-ante</strong></p>
<p>Las predicciones ex-ante son aquellas que se realizan en el futuro, utilizando únicamente la información disponible hasta el momento presente. Esto supone tener que realizar predicciones tanto para los predictores (variables exógenas) como para la variable de interés, tal como lo haríamos en una situación real.</p>
<p>En este caso tenemos dos fuentes de incertidumbre: la propia del modelo ajustado para explicar nuestra variable de interés y la incertidumbre debida a la predicción de los predictores.</p>
<p>Por ejemplo, en una serie de consumo eléctrico horario donde contamos con la Temperatura ambiente como predictor, para realizar predicciones futuras “ex-ante” necesitaremos predecir primero la Temperatura y así poder predecir el consumo eléctrico. Las predicciones de Temperatura las podemos realizar nosotros mismos o bien obtenerlas de agencias como AEMET.</p>
<p><strong>Predicciones ex-post</strong></p>
<p>Las predicciones ex-post son aquellas que se realizan utilizando observaciones reales de los predictores en el periodo para el cual se está haciendo la predicción. Por tanto, no se trata de una situación realista, puesto que se está asumiendo que los predictores se pueden predecir de forma perfecta.</p>
<p>En este caso tenemos una única fuente de incertidumbre: la del modelo ajustado que explica nuestra variable de interés en función de los predictores. En esencia, permite una evaluación más clara del rendimiento del modelo en estudio, separando otras fuentes de incertidumbre ajenas a dicho modelo.</p>
<p>Por ejemplo, en la serie de consumo eléctrico horario comentada anteriormente, las predicciones ex-post se obtendrían usando valores reales de temperatura para el periodo futuro de predicción, lo cual no es realista.</p>
<p><strong>Alternativas</strong></p>
<p>En el análisis de una serie temporal como la del ejemplo del consumo eléctrico horario, podemos plantear el cálculo de medidas de bondad del ajuste usando predicciones ex-ante y ex-post, con el fin de evaluar el rendimiento del modelo por sí solo y conjuntamente con la fuente de incertidumbre que supone predecir los predictores.</p>
<p>Cuando resulta complicado predecir los predictores, otra opción que se puede plantear consiste en utilizar los predictores retardados en el tiempo. Lo que se persigue es que las predicciones futuras de la variable de interés se puedan realizar sin necesidad de predecir los predictores.</p>
<p>Si queremos realizar predicciones con horizonte <span class="math inline">\(h\)</span>, el modelo a considerar sería:</p>
<p><span class="math display">\[
Y_{t+h} = \beta_0 + \beta_1 x_{1,t} + \beta_2 x_{2,t} + ...+ \beta_k x_{k,t}  + \varepsilon_t  \quad \text{con} \quad \varepsilon_t \sim N(0,\sigma^2) \   \text{independientes}, t \in \mathbb{T}.
\]</span></p>
<p>Esta formulación hace que el modelo sea operativo en un escenario realista, además de que permite considerar el efecto retardado que podrían tener algunos predictores sobre la variable de interés.</p>
<p><strong>Intervalos de predicción</strong></p>
<p>En la mayoría de las situaciones, cuando se habla de predicciones, nos referimos a predicciones puntuales. Es decir, un valor concreto que sirve de estimación de la futura observación para la variable de interés. Sin embargo, no proporcionamos información de la incertidumbre o error asociado a dicha estimación puntual.</p>
<p>Una manera de cuantificar el error asociado a la predicción puntual se consigue proporcinando un intervalo de predicción, que es un intervalo de la recta real que contendrá con probabilidad alta a la observación futura que pretendemos predecir. Los niveles de confianza que se fijan para obtener intervalos de predicción suelen ser del 90% al 99%. La forma común de obtener un intervalo de predicción es:</p>
<p><span class="math display">\[
\text{Intervalo Predicción}=(\text{Predicción Puntual} \pm \text{Margen Error})
\]</span></p>
<p>donde la predicción puntual sabemos que se obtiene sustituyendo los valores de los predictores en el modelo ajustado y el margen de error va a depender del nivel de confianza fijado y la distribución de los errores del modelo. Por tanto, para obtener un intervalo de predicción, es necesario conocer el modelo de distribución de los errores (de ahí la hipóstesis que necesitamos verificar en el modelo de regresión).</p>
<p>Por ejemplo, en el caso de una serie con <span class="math inline">\(T\)</span> observaciones modelizada mediante regresión lineal simple:</p>
<p><span class="math display">\[
Y_{t} = \beta_0 + \beta_1 x_{t} + \varepsilon_t  \quad \text{con} \quad \varepsilon_t \sim N(0,\sigma^2) \   \text{independientes}, t \in \mathbb{T}
\]</span></p>
<p>el intervalo de predicción aproximado, al 95% viene dado por:</p>
<p><span class="math display">\[
\hat{y} \pm 1.96 \hat{\sigma}_e \sqrt{1 + \frac {1}{T}+ \frac {(x- \bar{x})^2}{(T-1)s_x^2}}    
\]</span></p>
<p>donde la predicción puntual es:</p>
<p><span class="math display">\[
\hat{y} = \hat{\beta_0} +\hat{\beta_1} x   
\]</span></p>
<p>y la estimación de error estándar de la regresión simple es:</p>
<p><span class="math display">\[
\hat{\sigma}_e = \sqrt{\frac{1}{T-2} \sum_{t=1,...,T}e_t^2}    
\]</span></p>
<p><strong>Nota:</strong> El margen de error crece conforme el valor del predictor <span class="math inline">\(x\)</span> se aleja de la media.</p>
<p>Si la serie se modeliza mediante regresión lineal múltiple:</p>
<p><span class="math display">\[
Y_t = \beta_0 + \beta_1 x_{1,t} + \beta_2 x_{2,t} + ...+ \beta_k x_{k,t}  + \varepsilon_t  \quad \text{con} \quad \varepsilon_t \sim N(0,\sigma^2) \   \text{independientes}, t \in \mathbb{T}
\]</span></p>
<p>un intervalo de predicción aproximado, al <span class="math inline">\(100 \cdot (1-\alpha)\)</span>% de confianza, viene dado por:</p>
<p><span class="math display">\[
\hat{y} \pm z_{1- \frac{\alpha}{2}} \hat{\sigma}_e \sqrt{1+ \bf{x^{*}}(X'X)^{-1}\bf{(x^{*})'} }    
\]</span></p>
<p>donde <span class="math inline">\(\alpha\)</span> es el nivel de significación, <span class="math inline">\(z_{1- \frac{\alpha}{2}}\)</span> es el cuantil de la <span class="math inline">\(N(0,1)\)</span>, <span class="math inline">\(\bf{x^{*}}\)</span> denota el vector fila con los nuevos valores de los predictores, <span class="math inline">\(X\)</span> es la matriz de diseño del modelo RLM, <span class="math inline">\(\hat{y}\)</span> es la predicción puntual dada por:</p>
<p><span class="math display">\[
\hat{y} = \hat{\beta_0} +\hat{\beta_1} x_1 + \hat{\beta_2} x_2 + ...+ \hat{\beta_k} x_k  
\]</span></p>
<p>y <span class="math inline">\(\hat{\sigma}_e\)</span> es la desviación estándar residual dada por:</p>
<p><span class="math display">\[
\hat{\sigma}_e = \sqrt{\frac{1}{T-k-1} \sum_{t=1,...,T}e_t^2}    
\]</span></p>
</section>
</section>
<section id="ejemplo" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="ejemplo"><span class="header-section-number">8.5</span> Ejemplo</h2>
<p>Consideremos la serie “AirPassengers” incluida en R, cuyos datos se corresponden con el número de pasajeros mensuales en aerolíneas norteamericanas desde enero 1949 hasta diciembre 1960. Obsérvese que es un objeto de tipo “ts” (time series) y que su representación refleja un esquema multiplicativo entre tendencia y estacionalidad.</p>
<p>Con el fin de estimar un modelo de regresión lineal (en lugar de no-lineal), trabajaremos con la serie transformada mediante logaritmos neperianos, dando lugar a un esquema aditivo entre tendencia y estacionalidad.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(AirPassengers)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">log</span>(AirPassengers))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Tema7_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Parece claro que la serie log(AirPassengers) presenta estacionalidad y tendencia lineal en función del tiempo. Vamos a estimar un modelo de regresión lineal múltiple para explicar el comportamiento de la serie. Crearemos manualmente los predictores “tiempo” y “dummy estacionales”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">144</span>   <span class="co">#predictor tiempo</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>estacional.dummy <span class="ot">&lt;-</span> <span class="fu">seasonaldummy</span>(<span class="fu">log</span>(AirPassengers)) <span class="co">#predictores dummy estacionales</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>lm.model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(AirPassengers) <span class="sc">~</span> t <span class="sc">+</span> estacional.dummy)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm.model)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(AirPassengers) ~ t + estacional.dummy)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.156370 -0.041016  0.003677  0.044069  0.132324 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          4.7054593  0.0194850 241.491  &lt; 2e-16 ***
t                    0.0100688  0.0001193  84.399  &lt; 2e-16 ***
estacional.dummyJan  0.0213211  0.0242461   0.879 0.380816    
estacional.dummyFeb -0.0007338  0.0242400  -0.030 0.975897    
estacional.dummyMar  0.1294934  0.0242344   5.343 3.92e-07 ***
estacional.dummyApr  0.0982245  0.0242294   4.054 8.59e-05 ***
estacional.dummyMay  0.0958519  0.0242250   3.957 0.000124 ***
estacional.dummyJun  0.2179981  0.0242212   9.000 2.25e-15 ***
estacional.dummyJul  0.3219404  0.0242179  13.293  &lt; 2e-16 ***
estacional.dummyAug  0.3126456  0.0242153  12.911  &lt; 2e-16 ***
estacional.dummySep  0.1680110  0.0242132   6.939 1.64e-10 ***
estacional.dummyOct  0.0298527  0.0242118   1.233 0.219790    
estacional.dummyNov -0.1138650  0.0242109  -4.703 6.41e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.0593 on 131 degrees of freedom
Multiple R-squared:  0.9835,    Adjusted R-squared:  0.982 
F-statistic: 649.4 on 12 and 131 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Obtenemos una bondad del ajuste alta (Adjusted R-squared: 0.9764). Pero es importante verificar si los errores se comportan como un ruido blanco. Con los correlogramas simple y parcial concluimos que no es el caso. Por tanto, dichos errores deberían modelizarse con un ARIMA (véase la sección de regresión dinámica).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(lm.model<span class="sc">$</span>residuals)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Tema7_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Acf</span>(lm.model<span class="sc">$</span>residuals)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Pacf</span>(lm.model<span class="sc">$</span>residuals)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Tema7_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Veamos cómo sería el ajuste usando la función <em>tslm()</em> del paquete <em>forecast</em>, que permite crear automáticamente los predictores de la tendencia lineal y las dummy estacionales:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>tslm.model <span class="ot">&lt;-</span> <span class="fu">tslm</span>(<span class="fu">log</span>(AirPassengers) <span class="sc">~</span> trend <span class="sc">+</span> season)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tslm.model)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
tslm(formula = log(AirPassengers) ~ trend + season)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.156370 -0.041016  0.003677  0.044069  0.132324 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  4.7267804  0.0188935 250.180  &lt; 2e-16 ***
trend        0.0100688  0.0001193  84.399  &lt; 2e-16 ***
season2     -0.0220548  0.0242109  -0.911  0.36400    
season3      0.1081723  0.0242118   4.468 1.69e-05 ***
season4      0.0769034  0.0242132   3.176  0.00186 ** 
season5      0.0745308  0.0242153   3.078  0.00254 ** 
season6      0.1966770  0.0242179   8.121 2.98e-13 ***
season7      0.3006193  0.0242212  12.411  &lt; 2e-16 ***
season8      0.2913245  0.0242250  12.026  &lt; 2e-16 ***
season9      0.1466899  0.0242294   6.054 1.39e-08 ***
season10     0.0085316  0.0242344   0.352  0.72537    
season11    -0.1351861  0.0242400  -5.577 1.34e-07 ***
season12    -0.0213211  0.0242461  -0.879  0.38082    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.0593 on 131 degrees of freedom
Multiple R-squared:  0.9835,    Adjusted R-squared:  0.982 
F-statistic: 649.4 on 12 and 131 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">forecast</span>(tslm.model, <span class="at">h =</span> <span class="dv">24</span>))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Tema7_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>¿Y si usamos términos de Fourier en lugar de dummy estacionales? </strong></p>
<p>Veamos cómo afecta <span class="math inline">\(K\)</span> (número de términos de Fourier a incluir) a la modelización de la componente estacional:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>tslm.model_Fourier <span class="ot">&lt;-</span> <span class="fu">tslm</span>(<span class="fu">log</span>(AirPassengers) <span class="sc">~</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                             trend <span class="sc">+</span> <span class="fu">fourier</span>(<span class="fu">log</span>(AirPassengers), <span class="at">K =</span> <span class="dv">1</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tslm.model_Fourier)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
tslm(formula = log(AirPassengers) ~ trend + fourier(log(AirPassengers), 
    K = 1))

Residuals:
      Min        1Q    Median        3Q       Max 
-0.254905 -0.060940  0.004394  0.069431  0.186910 

Coefficients:
                                          Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)                              4.8145681  0.0150203 320.537  &lt; 2e-16
trend                                    0.0100360  0.0001798  55.809  &lt; 2e-16
fourier(log(AirPassengers), K = 1)S1-12 -0.0494811  0.0105698  -4.681 6.66e-06
fourier(log(AirPassengers), K = 1)C1-12 -0.1417735  0.0105500 -13.438  &lt; 2e-16
                                           
(Intercept)                             ***
trend                                   ***
fourier(log(AirPassengers), K = 1)S1-12 ***
fourier(log(AirPassengers), K = 1)C1-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.08951 on 140 degrees of freedom
Multiple R-squared:  0.9598,    Adjusted R-squared:  0.9589 
F-statistic:  1113 on 3 and 140 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">forecast</span>(tslm.model_Fourier, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">data.frame</span>(<span class="fu">fourier</span>(<span class="fu">log</span>(AirPassengers), <span class="at">K =</span> <span class="dv">1</span>, <span class="at">h =</span> <span class="dv">24</span>))))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Tema7_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tslm.model_Fourier <span class="ot">&lt;-</span> <span class="fu">tslm</span>(<span class="fu">log</span>(AirPassengers) <span class="sc">~</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                             trend <span class="sc">+</span> <span class="fu">fourier</span>(<span class="fu">log</span>(AirPassengers), <span class="at">K =</span> <span class="dv">4</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tslm.model_Fourier)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
tslm(formula = log(AirPassengers) ~ trend + fourier(log(AirPassengers), 
    K = 4))

Residuals:
      Min        1Q    Median        3Q       Max 
-0.137989 -0.041654  0.000409  0.044630  0.133818 

Coefficients:
                                          Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)                              4.8121301  0.0102284 470.467  &lt; 2e-16
trend                                    0.0100696  0.0001225  82.208  &lt; 2e-16
fourier(log(AirPassengers), K = 4)S1-12 -0.0493556  0.0071920  -6.863 2.28e-10
fourier(log(AirPassengers), K = 4)C1-12 -0.1418071  0.0071785 -19.754  &lt; 2e-16
fourier(log(AirPassengers), K = 4)S2-12  0.0786811  0.0071806  10.957  &lt; 2e-16
fourier(log(AirPassengers), K = 4)C2-12 -0.0228136  0.0071785  -3.178 0.001841
fourier(log(AirPassengers), K = 4)S3-12 -0.0087300  0.0071785  -1.216 0.226072
fourier(log(AirPassengers), K = 4)C3-12  0.0272914  0.0071785   3.802 0.000217
fourier(log(AirPassengers), K = 4)S4-12  0.0256117  0.0071778   3.568 0.000499
fourier(log(AirPassengers), K = 4)C4-12  0.0221465  0.0071785   3.085 0.002472
                                           
(Intercept)                             ***
trend                                   ***
fourier(log(AirPassengers), K = 4)S1-12 ***
fourier(log(AirPassengers), K = 4)C1-12 ***
fourier(log(AirPassengers), K = 4)S2-12 ***
fourier(log(AirPassengers), K = 4)C2-12 ** 
fourier(log(AirPassengers), K = 4)S3-12    
fourier(log(AirPassengers), K = 4)C3-12 ***
fourier(log(AirPassengers), K = 4)S4-12 ***
fourier(log(AirPassengers), K = 4)C4-12 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.0609 on 134 degrees of freedom
Multiple R-squared:  0.9822,    Adjusted R-squared:  0.981 
F-statistic: 819.9 on 9 and 134 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">forecast</span>(tslm.model_Fourier, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">data.frame</span>(<span class="fu">fourier</span>(<span class="fu">log</span>(AirPassengers), <span class="at">K =</span> <span class="dv">4</span>, <span class="at">h =</span> <span class="dv">24</span>))))</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Tema7_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Observamos que al aumentar <span class="math inline">\(K\)</span>, modelizamos la componente estacional de forma más precisa. En cualquier caso, los errores asociados al modelo estimado no son un ruido blanco, sino que están correlados. Por tanto deberían modelizarse con ARIMA (regresión dinámica).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Acf</span>(tslm.model_Fourier<span class="sc">$</span>residuals)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Pacf</span>(tslm.model_Fourier<span class="sc">$</span>residuals)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Tema7_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="modelos-de-regresión-dinámica" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="modelos-de-regresión-dinámica"><span class="header-section-number">8.6</span> Modelos de regresión dinámica</h2>
<p>Los modelos de regresión dinámica son una extensión de los modelos de regresión para series temporales, permitiendo la inclusión de efectos autoregresivos y de media móvil en los residuos del modelo. Esto es especialmente útil cuando las observaciones sucesivas en una serie temporal están correlacionadas. Por tanto, estos modelos incluyen tanto predictores exógenos como componentes ARIMA para los errores, lo que permite capturar la estructura de correlación en los residuos y mejorar la precisión de las predicciones.</p>
<p>El modelo de regresión dinámica suele expresarse de la siguiente forma:</p>
<p><span class="math display">\[
Y_t = \beta_0 + \beta_1 x_{1,t} + \beta_2 x_{2,t} + ...+ \beta_k x_{k,t}  + \eta_t     
\]</span></p>
<p>donde los errores <span class="math inline">\(\eta_t\)</span> no son un ruido blanco sino que se modelizan con un <span class="math inline">\(ARIMA(p, d, q)\)</span> mediante:</p>
<p><span class="math display">\[
(1-a_1B-a_2B^2-...-a_pB^p)(1-B)^d\eta_t=(1+b_1B+b_2B^2+...+b_qB^q)\varepsilon_t
\]</span></p>
<p>con <span class="math inline">\(\varepsilon_t\sim N(0,\sigma^2)\ \text{independientes}, t \in \mathbb{T}\)</span>, es decir, ruido blanco. En realidad, los errores <span class="math inline">\(\eta_t\)</span> pueden corresponder con un modelo ARIMA estacional (SARIMA) o no estacional (simplemente ARIMA).</p>
<p>Obsérvese que el modelo contempla dos fuentes de error: la perturbación <span class="math inline">\(\eta_t\)</span> del modelo de regresión y el término de error <span class="math inline">\(\varepsilon_t\)</span> del modelo ARIMA.</p>
<p>Para estimar los coeficientes del modelo de regresión dinámica se debe minimizar la suma de cuadrados de los errores <span class="math inline">\(\varepsilon_t\)</span>, pues si se plantea la minimización de los errores <span class="math inline">\(\eta_t\)</span>, la estimación de los coeficientes no sería apropiada y tampoco las inferencias sobre ellos. También se puede recurrir a la estimación por máxima verosimilitud.</p>
<p><strong>Importante:</strong> Para estimar adecuadamente los coeficientes del modelo de regresión dinámica, es necesario que todas las series que intervienen (tanto la variable de interés como predictores) sean estacionarias.</p>
<p>En general, si alguna de las series no es estacionaria, se tomarán diferencias en cada una de ellas (no sólo en la que no es estacionaria), consiguiendo así que todas sean estacionarias y se mantenga el tipo de relación inicial.</p>
<p>Como es habitual en este contexto, tras el análisis descriptivo previo de la serie y la realización de las transformaciones necesarias, se procede a la <strong>selección y validación del modelo</strong>, etapas que se realizan con procedimientos similares a los vistos con anterioridad, incluyendo la consideración de predictores útiles como variables de tipo calendario o variables retardadas en el tiempo. Y finalmente, para las <strong>predicciones</strong>, se combinan los resultados de predecir tanto la parte del modelo de regresión como la parte ARIMA de los errores. También en este caso se podrán obtener predicciones puntuales e intervalos de predicción.</p>
<p><strong>Regresión dinámica con presencia de estacionalidad</strong></p>
<p>Como vimos en los modelos de regresión múltiple para series, la estacionalidad puede modelizarse de dos formas: mediante el uso de variables dummy o incluyendo términos de Fourier, siendo preferible el uso de los términos de Fourier en el caso de valores altos de la periodicidad. Por otro lado, los modelos ETS y SARIMA están diseñados para periodicidades bajas, como máximo de 24.</p>
<p>Para las series con periodicidad alta (superiores a 12 o 24) y para las series que presentan diferentes valores de periodicidad (por ejemplo, datos horarios con periodicidades de un día, <span class="math inline">\(L_1=24\)</span>, y de una semana, <span class="math inline">\(L_2=168\)</span>), se recomienda el uso de las series de Fourier para modelizar la componente estacional. Con el número de términos de Fourier a incluir en el modelo (parámetro denotado por <span class="math inline">\(K\)</span>), se controla el suavizado de la componente estacional. Otra ventaja de usar los términos de Fourier para modelizar la estacionalidad de la serie es que, en general, se consigue que los errores <span class="math inline">\(\eta_t\)</span> puedan modelarse con un modelo ARIMA no estacional.</p>
<p><strong>Ejemplo</strong></p>
<p>Seguiremos con el ejemplo de la serie AirPassengers de la sección anterior, donde vimos que tras realizar el ajuste del modelo de regresión múltiple, los errores estaban correlados.</p>
<p>Para el ajuste del modelo de regresión dinámica (ajuste conjunto del modelo de regresión y del modelo ARIMA), conviene que todas las series que intervienen sean estacionarias. Por tanto, trabajaremos con la serie transformada:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>serie_estacionaria <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">log</span>(AirPassengers), <span class="dv">1</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(serie_estacionaria)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Tema7_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Con la función <em>auto.arima()</em> del paquete <em>forecast</em>, realizaremos la selección automática de los órdenes (p,d,q)(P,D,Q) del modelo SARIMA para los errores, usando como predictores del modelo de regresión las variables exógenas “dummy estacionales”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>estacional.dummy <span class="ot">&lt;-</span> <span class="fu">seasonaldummy</span>(serie_estacionaria)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>dyreg.model_auto <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(serie_estacionaria, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xreg =</span> <span class="fu">as.matrix</span>(estacional.dummy))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dyreg.model_auto)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: serie_estacionaria 
Regression with ARIMA(1,0,1)(1,0,0)[12] errors 

Coefficients:
         ar1      ma1    sar1  intercept      Jan      Feb     Mar      Apr
      0.6011  -0.8724  0.2290     0.1240  -0.0978  -0.1350  0.0144  -0.1422
s.e.  0.2141   0.1537  0.0876     0.0132   0.0206   0.0196  0.0192   0.0191
          May     Jun      Jul      Aug      Sep      Oct      Nov
      -0.1175  0.0076  -0.0096  -0.1238  -0.2583  -0.2513  -0.2582
s.e.   0.0189  0.0189   0.0189   0.0191   0.0193   0.0197   0.0203

sigma^2 = 0.001306:  log likelihood = 279.36
AIC=-526.72   AICc=-522.41   BIC=-479.32

Training set error measures:
                        ME       RMSE        MAE MPE MAPE      MASE        ACF1
Training set -7.885777e-05 0.03418937 0.02630177 NaN  Inf 0.7618447 -0.06587283</code></pre>
</div>
</div>
<p>Observamos que ahora los residuos se pueden asumir independientes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Acf</span>(dyreg.model_auto<span class="sc">$</span>residuals)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Pacf</span>(dyreg.model_auto<span class="sc">$</span>residuals)</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Tema7_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copiado");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copiado");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Tema6.html" class="pagination-link" aria-label="Tema 6. Modelos ARIMA">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Tema 6. Modelos ARIMA</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>